# 未完成功能清单

> 生成时间: 2025-10-27
> 总计: 133 个待完成项
> 来源: 代码库中的 TODO/FIXME/待完善 标记

---

## 📊 概览统计

| 模块分类   | 待完成项数 | 优先级 | 预计工作量 |
| ---------- | ---------- | ------ | ---------- |
| 语音引擎   | 10         | P0     | 3-5 天     |
| Agent 引擎 | 12         | P1     | 5-7 天     |
| 索引服务   | 3          | P1     | 2-3 天     |
| 检索服务   | 7          | P0     | 3-4 天     |
| 模型适配器 | 4          | P1     | 2-3 天     |
| 多模态引擎 | 3          | P2     | 2 天       |
| RAG 引擎   | 1          | P1     | 1 天       |
| 对话服务   | 4          | P1     | 2-3 天     |
| 身份服务   | 3          | P0     | 2 天       |
| 知识服务   | 5          | P1     | 2-3 天     |
| 模型路由   | 4          | P0     | 2 天       |
| AI 编排器  | 2          | P0     | 1-2 天     |
| 分析服务   | 4          | P2     | 2-3 天     |
| Flink 作业 | 3          | P2     | 3-4 天     |
| 基础设施   | 3          | P1     | 1-2 天     |

**总预计工作量**: 35-50 人天

---

## 🎯 P0 优先级（核心功能，阻碍上线）

### 1. 语音引擎 (voice-engine)

#### 1.1 全双工引擎 - 音频打断

- **文件**: `algo/voice-engine/app/core/full_duplex_engine.py:205`
- **问题**: 打断机制未完整实现
- **影响**: 用户无法自然打断 AI 说话
- **工作量**: 1 天

#### 1.2 TTS 语音克隆

- **文件**: `algo/voice-engine/app/core/tts_engine.py:347`
- **问题**: 个性化语音合成未实现
- **影响**: 无法提供定制化语音服务
- **工作量**: 2-3 天

#### 1.3 降噪与音频增强

- **文件**: `algo/voice-engine/main.py:261,264`
- **问题**: 音质优化缺失
- **影响**: 嘈杂环境下识别率低
- **工作量**: 2 天

#### 1.4 Azure Speech SDK 集成

- **文件**:
  - `algo/voice-engine/app/services/tts_service.py:132`
  - `algo/voice-engine/app/services/asr_service.py:190`
- **问题**: 多厂商语音服务未接入
- **影响**: 缺少备用语音服务提供商
- **工作量**: 1-2 天

#### 1.5 流式 ASR 识别

- **文件**: `algo/voice-engine/app/routers/asr.py:91`
- **问题**: 仅支持批量识别
- **影响**: 实时对话体验差
- **工作量**: 2 天

#### 1.6 音频时长计算

- **文件**: `algo/voice-engine/app/services/tts_service.py:69`
- **问题**: 缺少音频元数据
- **影响**: 无法统计 TTS 使用量
- **工作量**: 0.5 天

#### 1.7 Redis 缓存

- **文件**: `algo/voice-engine/app/services/tts_service.py:194,199`
- **问题**: TTS 结果未缓存
- **影响**: 相同文本重复合成，成本高
- **工作量**: 1 天

#### 1.8 健康检查

- **文件**:
  - `algo/voice-engine/app/routers/health.py:25`
  - `algo/retrieval-service/app/routers/health.py:25`
  - `algo/multimodal-engine/app/routers/health.py:25`
- **问题**: 健康检查不完整
- **影响**: K8s 无法正确探测服务状态
- **工作量**: 0.5 天

---

### 2. 检索服务 (retrieval-service)

#### 2.1 Embedding 服务调用

- **文件**: `algo/retrieval-service/app/services/retrieval_service.py:44,88`
- **问题**: 向量检索依赖未实现
- **影响**: 无法进行语义搜索
- **工作量**: 1 天

#### 2.2 BM25 索引加载

- **文件**: `algo/retrieval-service/app/core/bm25_retriever.py:37`
- **问题**: BM25 索引未持久化
- **影响**: 重启后丢失 BM25 索引
- **工作量**: 1-2 天

#### 2.3 图谱检索

- **文件**: `algo/retrieval-service/app/core/graph_retriever.py:67,82`
- **问题**: 知识图谱检索未实现
- **影响**: 无法利用结构化知识
- **工作量**: 2-3 天

#### 2.4 LLM 重排序

- **文件**: `algo/retrieval-service/app/core/reranker.py:85,96`
- **问题**: 高级重排序缺失
- **影响**: 检索精度不足
- **工作量**: 1-2 天

---

### 3. 身份服务 (identity-service)

#### 3.1 Token 黑名单

- **文件**: `cmd/identity-service/internal/biz/auth_usecase.go:201`
- **问题**: 用户登出后 Token 仍有效
- **影响**: 安全风险
- **工作量**: 1 天

#### 3.2 租户删除保护

- **文件**: `cmd/identity-service/internal/biz/tenant_usecase.go:173`
- **问题**: 可能误删有数据的租户
- **影响**: 数据一致性风险
- **工作量**: 0.5 天

#### 3.3 JWT 验证中间件

- **文件**: `pkg/middleware/auth.go:30`
- **问题**: 网关鉴权未实现
- **影响**: 无法保护 API
- **工作量**: 1 天

---

### 4. 模型路由 (model-router)

#### 4.1 路由逻辑

- **文件**: `cmd/model-router/main.go:116`
- **问题**: 智能路由未实现
- **影响**: 无法根据负载/成本选择模型
- **工作量**: 1-2 天

#### 4.2 模型信息获取

- **文件**: `cmd/model-router/main.go:158`
- **问题**: 模型配置硬编码
- **影响**: 无法动态管理模型
- **工作量**: 0.5 天

#### 4.3 健康检查

- **文件**: `cmd/model-router/main.go:172`
- **问题**: 无法检测后端模型服务状态
- **影响**: 可能路由到不可用的模型
- **工作量**: 0.5 天

#### 4.4 成本告警

- **文件**: `cmd/model-router/internal/application/cost_optimizer.go:96`
- **问题**: 成本超标无通知
- **影响**: 成本控制失效
- **工作量**: 0.5 天

---

### 5. AI 编排器 (ai-orchestrator)

#### 5.1 流式响应

- **文件**: `cmd/ai-orchestrator/main.go:172`
- **问题**: 仅支持批量响应
- **影响**: 用户等待时间长
- **工作量**: 1-2 天

#### 5.2 服务发现集成

- **文件**: `cmd/ai-orchestrator/IMPLEMENTATION_SUMMARY.md:288`
- **问题**: 硬编码服务地址
- **影响**: 服务扩展性差
- **工作量**: 1 天

---

## 🔵 P1 优先级（重要功能，影响体验）

### 6. Agent 引擎 (agent-engine)

#### 6.1 记忆管理 - 向量检索

- **文件**: `algo/agent-engine/app/memory/memory_manager.py:209,282,306`
- **问题**: Agent 无长期记忆能力
- **影响**: 无法个性化对话
- **工作量**: 2-3 天

#### 6.2 工具实现

- **文件**:
  - `algo/agent-engine/app/tools/tool_registry.py:246,261,267`
  - `algo/agent-engine/app/core/tools/builtin_tools.py:34,65,79`
- **问题**: 工具调用都是 Mock
- **影响**: Agent 无实际能力
- **工作量**: 3-4 天

#### 6.3 动态工具注册

- **文件**: `algo/agent-engine/main.py:225`
- **问题**: 工具不可扩展
- **影响**: 无法快速增加新能力
- **工作量**: 1-2 天

#### 6.4 ReAct 流式输出

- **文件**: `algo/agent-engine/app/workflows/react_agent.py:385`
- **问题**: 无法实时看到推理过程
- **影响**: 调试困难
- **工作量**: 1 天

#### 6.5 Plan-Execute 执行器

- **文件**: `algo/agent-engine/app/core/executor/plan_execute_executor.py:97`
- **问题**: 规划模式未实现
- **影响**: 无法处理复杂任务
- **工作量**: 2-3 天

#### 6.6 Agent 路由逻辑

- **文件**: `algo/agent-engine/routers/agent.py:34,53`
- **问题**: 主入口未实现
- **影响**: 服务无法使用
- **工作量**: 1-2 天

---

### 7. 索引服务 (indexing-service)

#### 7.1 LLM 关系抽取

- **文件**: `algo/indexing-service/app/core/entity_extractor.py:233`
- **问题**: 知识图谱构建不完整
- **影响**: 图谱质量差
- **工作量**: 2-3 天

#### 7.2 Kafka 事件发布

- **文件**: `algo/indexing-service/app/kafka_consumer.py:281`
- **问题**: 索引完成无通知
- **影响**: 下游服务无法感知
- **工作量**: 1 天

---

### 8. 模型适配器 (model-adapter)

#### 8.1 多厂商适配

- **文件**: `algo/model-adapter/README.md:28-30`
- **问题**: 仅支持 OpenAI，缺少国产模型（智谱/通义/文心）
- **影响**: 缺少国产模型支持
- **工作量**: 2-3 天

---

### 9. 对话服务 (conversation-service)

#### 9.1 Kafka 事件发布

- **文件**: `cmd/conversation-service/IMPLEMENTATION_SUMMARY.md:295`
- **问题**: 对话事件无法被其他服务消费
- **影响**: 无法做分析和监控
- **工作量**: 1 天

#### 9.2 上下文压缩

- **文件**: `cmd/conversation-service/IMPLEMENTATION_SUMMARY.md:355`
- **问题**: 长对话会超出上下文窗口
- **影响**: 长对话失败
- **工作量**: 1-2 天

#### 9.3 高级对话管理

- **文件**: `cmd/conversation-service/IMPLEMENTATION_SUMMARY.md:356`
- **问题**: 缺少对话状态机
- **影响**: 复杂对话场景处理差
- **工作量**: 2-3 天

---

### 10. 知识服务 (knowledge-service)

#### 10.1 事件补偿机制

- **文件**: `cmd/knowledge-service/internal/biz/document_usecase.go:147,229`
- **问题**: 事件发布失败无重试
- **影响**: 数据一致性风险
- **工作量**: 1-2 天

#### 10.2 清理任务

- **文件**: `cmd/knowledge-service/internal/biz/document_usecase.go:209`
- **问题**: 删除的文档无法清理
- **影响**: 存储泄漏
- **工作量**: 1 天

---

### 11. RAG 引擎 (rag-engine)

#### 11.1 历史对话获取

- **文件**: `algo/rag-engine/app/core/rag_engine.py:246`
- **问题**: 无法利用历史上下文
- **影响**: 多轮对话能力差
- **工作量**: 1 天

---

### 12. 基础设施

#### 12.1 事件消费延迟

- **文件**: `pkg/events/consumer.go:301`
- **问题**: 无法控制消费速率
- **影响**: 可能压垮下游
- **工作量**: 0.5 天

---

## 🟢 P2 优先级（Nice to have）

### 13. 多模态引擎 (multimodal-engine)

#### 13.1 EasyOCR 集成

- **文件**: `algo/multimodal-engine/app/services/ocr_service.py:181`
- **问题**: 仅支持 PaddleOCR
- **影响**: 缺少备用 OCR 方案
- **工作量**: 1 天

#### 13.2 批量 OCR

- **文件**: `algo/multimodal-engine/README.md:284`
- **问题**: 无批量处理能力
- **影响**: 大量图片处理效率低
- **工作量**: 1 天

---

### 14. 分析服务 (analytics-service)

#### 14.1 报表生成

- **文件**: `cmd/analytics-service/internal/biz/report_usecase.go:105,119,131,143`
- **问题**: 所有报表功能未实现（使用/成本/模型/用户报表）
- **影响**: 无数据洞察
- **工作量**: 2-3 天

---

### 15. Flink 作业

#### 15.1 文档分析作业

- **文件**: `flink-jobs/document-analysis/main.py:17`
- **问题**: 文档质量分析未实现
- **影响**: 无法评估知识库质量
- **工作量**: 2 天

#### 15.2 用户行为分析

- **文件**: `flink-jobs/user-behavior/main.py:17`
- **问题**: 用户画像未实现
- **影响**: 无法个性化推荐
- **工作量**: 2 天

#### 15.3 消息统计作业

- **文件**: `flink-jobs/message-stats/main.py:65,72`
- **问题**: 实时统计未完成
- **影响**: 无法监控消息量
- **工作量**: 1-2 天

---

## 📋 按工作量排序的待办清单

### 🚀 短期任务（≤1 天）

| 序号 | 任务               | 优先级 | 工作量 | 阻塞项 |
| ---- | ------------------ | ------ | ------ | ------ |
| 1    | Token 黑名单机制   | P0     | 1 天   | 否     |
| 2    | Embedding 服务调用 | P0     | 1 天   | 否     |
| 3    | JWT 验证中间件     | P0     | 1 天   | 否     |
| 4    | 音频时长计算       | P0     | 0.5 天 | 否     |
| 5    | Redis TTS 缓存     | P0     | 1 天   | 否     |
| 6    | 健康检查完善       | P0     | 0.5 天 | 否     |
| 7    | Kafka 事件发布     | P1     | 1 天   | 否     |
| 8    | 服务发现集成       | P0     | 1 天   | 否     |
| 9    | 历史对话获取       | P1     | 1 天   | 否     |
| 10   | 租户删除保护       | P0     | 0.5 天 | 否     |
| 11   | 模型信息获取       | P0     | 0.5 天 | 否     |
| 12   | 模型健康检查       | P0     | 0.5 天 | 否     |
| 13   | 成本告警           | P0     | 0.5 天 | 否     |
| 14   | 清理任务           | P1     | 1 天   | 否     |
| 15   | 事件消费延迟       | P1     | 0.5 天 | 否     |

**小计**: 11.5 天

### 📅 中期任务（2-3 天）

| 序号 | 任务                | 优先级 | 工作量 | 依赖         |
| ---- | ------------------- | ------ | ------ | ------------ |
| 16   | 语音克隆            | P0     | 2-3 天 | TTS 模型选型 |
| 17   | 降噪与增强          | P0     | 2 天   | 音频处理库   |
| 18   | 流式 ASR            | P0     | 2 天   | 无           |
| 19   | Azure SDK 集成      | P0     | 1-2 天 | Azure 账号   |
| 20   | 流式响应            | P0     | 1-2 天 | 无           |
| 21   | BM25 索引持久化     | P0     | 1-2 天 | 存储方案     |
| 22   | 图谱检索            | P0     | 2-3 天 | Neo4j        |
| 23   | LLM 重排序          | P0     | 1-2 天 | LLM 服务     |
| 24   | 模型路由逻辑        | P0     | 1-2 天 | 路由策略     |
| 25   | Agent 记忆管理      | P1     | 2-3 天 | 向量数据库   |
| 26   | 工具实现            | P1     | 3-4 天 | 各 API       |
| 27   | 动态工具注册        | P1     | 1-2 天 | 无           |
| 28   | ReAct 流式输出      | P1     | 1 天   | 无           |
| 29   | Agent 路由逻辑      | P1     | 1-2 天 | LangGraph    |
| 30   | LLM 关系抽取        | P1     | 2-3 天 | LLM 服务     |
| 31   | 多厂商模型适配      | P1     | 2-3 天 | API Key      |
| 32   | 上下文压缩          | P1     | 1-2 天 | 压缩策略     |
| 33   | 高级对话管理        | P1     | 2-3 天 | 状态机设计   |
| 34   | 事件补偿机制        | P1     | 1-2 天 | 补偿框架     |
| 35   | Plan-Execute 执行器 | P1     | 2-3 天 | 工具系统     |

**小计**: 30-45 天

### 📆 长期任务（3 天以上）

| 序号 | 任务           | 优先级 | 工作量 | 备注         |
| ---- | -------------- | ------ | ------ | ------------ |
| 36   | Flink 作业完善 | P2     | 5-6 天 | 可并行       |
| 37   | 报表生成系统   | P2     | 2-3 天 | 可延后       |
| 38   | 批量 OCR       | P2     | 1 天   | Nice to have |
| 39   | EasyOCR 备份   | P2     | 1 天   | Nice to have |

**小计**: 9-11 天

**总计**: 50.5-67.5 人天

---

## 🎯 建议实施路线图

### Sprint 1: 核心阻塞项（1 周，5 人）

**目标**: 解除上线阻塞

- [ ] **安全基线** (2 天)

  - Token 黑名单 + JWT 验证
  - 租户删除保护

- [ ] **实时体验** (2 天)

  - 流式 ASR
  - 流式响应

- [ ] **检索核心** (1 天)

  - Embedding 服务调用

- [ ] **路由与监控** (1 天)
  - 模型路由逻辑
  - 健康检查完善

**产出**: 核心链路可用，可进入 Alpha 测试

---

### Sprint 2: 语音与检索增强（1 周，5 人）

**目标**: 提升核心能力

- [ ] **语音质量** (3 天)

  - 降噪与音频增强
  - TTS 缓存 + 时长统计
  - Azure SDK 备份

- [ ] **检索精度** (3 天)

  - BM25 索引持久化
  - LLM 重排序

- [ ] **基础设施** (1 天)
  - 服务发现集成
  - 事件消费延迟控制

**产出**: 语音质量+检索精度提升 20%+

---

### Sprint 3: Agent 能力建设（2 周，4 人）

**目标**: 智能化升级

- [ ] **记忆与推理** (5 天)

  - Agent 记忆管理（向量检索）
  - ReAct 流式输出
  - Agent 路由逻辑

- [ ] **工具生态** (5 天)
  - 工具实现（搜索/知识库/天气）
  - 动态工具注册
  - Plan-Execute 执行器

**产出**: 可用的 Agent 系统，支持复杂任务

---

### Sprint 4: 生态完善（2 周，3 人）

**目标**: 功能完整性

- [ ] **模型生态** (3 天)

  - 多厂商模型适配
  - 模型信息动态管理
  - 成本告警

- [ ] **知识增强** (3 天)

  - LLM 关系抽取
  - 图谱检索（可选）

- [ ] **对话增强** (3 天)

  - 上下文压缩
  - 高级对话管理

- [ ] **可靠性** (3 天)
  - 事件补偿机制
  - 清理任务
  - Kafka 事件发布

**产出**: 生产级系统

---

### Sprint 5: 分析与优化（可选，2 周，2 人）

**目标**: 数据驱动

- [ ] **数据洞察** (5 天)

  - 报表生成系统
  - Flink 实时分析

- [ ] **多模态增强** (2 天)

  - 批量 OCR
  - EasyOCR 备份

- [ ] **个性化** (3 天)
  - 语音克隆（如需要）
  - 用户画像

**产出**: 数据洞察能力，支持运营决策

---

## 📝 实施注意事项

### 🔗 依赖管理

| 依赖项     | 依赖模块           | 优先级 | 建议                      |
| ---------- | ------------------ | ------ | ------------------------- |
| Redis      | 缓存、黑名单、去重 | P0     | 优先完成 Redis 集成与配置 |
| Kafka      | 事件驱动、审计     | P1     | 建立统一的事件框架        |
| 向量数据库 | Agent 记忆、检索   | P1     | 确认 Milvus/pgvector 选型 |
| LLM 服务   | 重排、抽取、推理   | P0     | 统一 LLM 客户端封装       |
| Neo4j      | 图谱检索           | P2     | 可延后，先完成向量检索    |

### ⚠️ 技术债务

1. **Mock 数据**: 多处使用硬编码/Mock

   - 风险: 生产环境可能出现意外
   - 建议: 统一标记并在测试中覆盖
   - 影响模块: Agent 工具、检索服务、模型路由

2. **错误处理**: 部分 TODO 缺少异常处理

   - 风险: 服务稳定性差
   - 建议: 补充完整的错误处理和日志
   - 重点: P0 模块必须完善错误处理

3. **配置管理**: 部分配置硬编码

   - 风险: 环境切换困难
   - 建议: 迁移到配置中心（Consul/Nacos）
   - 影响: 模型配置、服务地址、密钥

4. **性能优化**: 缺少缓存和批处理
   - 风险: 高成本、低性能
   - 建议: 优先实现 Redis 缓存
   - 重点: TTS 缓存、检索结果缓存

### ✅ 质量保障

每个功能交付必须满足：

- [ ] **代码质量**

  - 单元测试覆盖率 ≥ 70%
  - 代码审查通过
  - Lint 检查无错误

- [ ] **功能质量**

  - P0 功能必须有集成测试
  - 关键路径必须有 E2E 测试
  - 异常场景有覆盖

- [ ] **性能质量**

  - 性能敏感功能必须有压测
  - 响应时间符合 NFR 要求
  - 资源使用在预期范围

- [ ] **可观测性**

  - 关键操作有日志
  - 关键指标有监控
  - 异常有告警

- [ ] **文档完整**
  - API 文档更新
  - 部署文档更新
  - Runbook 更新

### 📊 进度跟踪

建议使用以下方式跟踪：

1. **GitHub Issues**: 为每个 TODO 创建 Issue

   - 标签: `type/feature`, `priority/p0`, `area/voice-engine`
   - 关联: 链接到对应代码位置
   - 验收: 明确的 AC（Acceptance Criteria）

2. **项目看板**: 使用 GitHub Projects

   - 列: Backlog → In Progress → Review → Done
   - Sprint 视图: 每周迭代
   - Milestone: 对应上述 Sprint

3. **每日站会**: 15 分钟同步

   - 昨天完成了什么
   - 今天计划做什么
   - 遇到什么阻碍

4. **周报**: 每周五发送
   - 完成的功能（带链接）
   - 下周计划
   - 风险与依赖

---

## 🔗 相关文档

- [任务检查清单](roadmap/TASK_CHECKLIST.md)
- [迭代计划](roadmap/ITERATION_PLAN.md)
- [服务完成报告](services/)
- [架构文档](arch/)
- [API 文档](api/)
- [NFR 基线](nfr/)

---

## 📞 联系方式

如有疑问或需要优先级调整，请联系:

- **Tech Lead**: [待定]
- **AI Lead**: [待定]
- **Backend Lead**: [待定]
- **SRE**: [待定]
- **项目经理**: [待定]

---

## 🔄 更新日志

| 日期       | 版本 | 变更                       | 作者 |
| ---------- | ---- | -------------------------- | ---- |
| 2025-10-27 | v1.0 | 初始版本，扫描 133 个 TODO | AI   |

---

_本文档由代码扫描自动生成，建议每周更新一次_

**扫描命令**:

```bash
grep -r "TODO\|FIXME\|XXX\|HACK\|待完善\|待实现\|未完成\|WIP" --include="*.py" --include="*.go" --include="*.ts" --include="*.tsx" --include="*.md" .
```
